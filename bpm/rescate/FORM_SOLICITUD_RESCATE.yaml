type:  object
title: Solicitar Rescate
hints:
  outcomes:
    - guardar: "Guardar"
    - finalizar: "Cancelar"
  outcomeVariable: tipoResultado
  fieldOrder:
    - fecha
    - cuenta
    - array_solicitudes_pendientes
    - ___expr____solicitud_confirmada
  feedback:
    "Calcular": "run:INSTFCI/CALCULAR"
    "__Clean_calc": |
      #!python3
      import redflagbpm
      bpm = redflagbpm.BPMService()
      array_solicitudes_pendientes = bpm.context.input['array_solicitudes_pendientes']
      __source=bpm.context['__source']
      """
      borro los calculos únicamente del elemento del array que el usuario modifica (en vez del array completo)
      __source es la ruta de lo que se está modificando en el clean.
      Es decir, si cambia el campo cantidad de la primera fila:
      __source=['array_pendientes', 0, 'cantidad']
      Si cambia el campo monto de la segunda fila:
      __source=['array_pendientes', 1 ,'monto']
      La fila se obtiene con __source[1]
      """
      array_solicitudes_pendientes[__source[1]]['calculos'] = None
      bpm.context.input['array_solicitudes_pendientes'] = array_solicitudes_pendientes
    "__Clean_monto": |
      #!python3
      import redflagbpm
      bpm = redflagbpm.BPMService()
      array_solicitudes_pendientes = bpm.context.input['array_solicitudes_pendientes']
      __source=bpm.context['__source']
      array_solicitudes_pendientes[__source[1]]['monto'] = None
      bpm.context.input['array_solicitudes_pendientes'] = array_solicitudes_pendientes
    "__Clean_cp": |
      #!python3
      import redflagbpm
      bpm = redflagbpm.BPMService()
      array_solicitudes_pendientes = bpm.context.input['array_solicitudes_pendientes']
      __source=bpm.context['__source']
      array_solicitudes_pendientes[__source[1]]['cantidad_importe'] = None
      bpm.context.input['array_solicitudes_pendientes'] = array_solicitudes_pendientes
  validation: "run:INSTFCI/VALIDAR_RESCATE"
  defaults: |
    #!python
    input.put("array_solicitudes_pendientes",[{}])
required:
- fecha
- cuenta
properties:
  fecha:
    title: Fecha
    type: integer
    hints:
      subtype: timestamp
      readOnly: true
      rowStart: true
      rowEnd: true
    default: now
  cuenta:
    title: Cuenta
    type: string
    hints:
      colspan: 2
      subtype: comitente
      rowStart: true
      rowEnd: true
      valueProvider: "ID_CLIENTE_COM_FULL"
  array_solicitudes_pendientes:
    type: array
    items:
      type: object
      hints:
        fieldOrder:
          - fondo
          - cantidad_importe
#          - rescate_dinero
          - monto
          - calculos
          - error
        titlePlural: Solicitudes Pendientes
      title: ""
      required:
        - fondo
      properties:
        fondo:
          title: Fondo
          type: string
          hints:
            valueProvider: "INSTFCI/QRY_FCI"
            dependents:
              - "@__Clean_calc"
        cantidad_importe:
          title: Cuotapartes
          type: number
          hints:
            mask: '#,##0.000000'
            dependents:
              - "@__Clean_calc"
              - "@__Clean_monto"
        monto:
          title: Monto (aproximado)
          type: number
          hints:
            mask: '#,##0.00'
            dependents:
              - "@__Clean_cp"
              - "@__Clean_calc"
#        rescate_dinero:
#          title: Rescate en Dinero
#          type: boolean
#          default: false
#          readOnly: true
        calculos:
          type: string
          title: Cálculos
          hints:
            rowStart: true
            rowEnd: true
            subtype: expression
        error:
          title: Error
          type: string
          hints:
            rowStart: true
            rowEnd: true
            subtype: expression
  ___expr____solicitud_confirmada:
    type: string
    title: Solicitud Confirmada
    default: false
    hints:
      subtype: expression
      rowStart: true
      rowEnd: true
      value: "#!run:INSTFCI/TEMPLATE_SOLICITUD_RESCATE_CONFIRMADO"